# ============================================================
# BulletTrade 实盘环境配置示例
# 复制此文件为 .env 即可用于实盘交易
# ⚠️ 包含敏感信息，请勿提交到 git
# ============================================================

# ============ 实盘模式（重要！） ============

# 实盘模式 (dry_run=模拟, live=真实交易)
# ⚠️ 首次使用请先用 dry_run 测试
LIVE_MODE=dry_run

# ============ 数据源配置（必需） ============

# 数据源类型
DEFAULT_DATA_PROVIDER=qmt

# QMT（迅投量化交易系统）配置
QMT_HOST=127.0.0.1
QMT_PORT=58610

# MiniQMT 数据目录与模式（安装 miniQMT/xtquant 后可启用）
#MINIQMT_AUTO_DOWNLOAD=true
#MINIQMT_CACHE_DIR=~/.bullet-trade/miniqmt-cache

# JQData（也可用于实盘数据获取）
JQDATA_USERNAME=138xxxxxxxx
JQDATA_PASSWORD=your_password
JQDATA_SERVER=
JQDATA_PORT=
JQDATA_CACHE_DIR=~/.jqdatasdk/cache
# 兼容旧变量：JQDATA_USER/JQDATA_PWD

# ============ 券商配置（必需） ============

# 券商类型 (qmt, simulator)
DEFAULT_BROKER=qmt

# QMT 券商配置
# ⚠️ 仅支持 Windows 环境：请先安装国金 QMT 交易端与 xtquant Python SDK，并保持 QMT 客户端登录。
# ⚠️ `QMT_DATA_PATH` 需指向 xtquant 的 userdata_mini 目录，`QMT_ACCOUNT_ID`/`TYPE` 与 QMT 客户端一致。
QMT_ACCOUNT_ID=your_account_id
QMT_ACCOUNT_TYPE=stock    # stock=股票, future=期货
QMT_DATA_PATH=C:\国金QMT交易端模拟\userdata_mini
#QMT_SESSION_ID=1699942134123    # 可选：指定固定会话 ID，不填写则自动使用当前时间戳
#QMT_AUTO_SUBSCRIBE=true         # 可选：是否在 connect() 时自动订阅账户

# 模拟器配置（用于 dry_run 模式）
SIMULATOR_INITIAL_CASH=1000000

# ============ 风控配置（重要！） ============

# 单笔订单最大金额（元）
MAX_ORDER_VALUE=100000

# 单日最大交易金额（元）
MAX_DAILY_TRADE_VALUE=500000

# 单日最大交易次数（避免程序异常时频繁交易）
MAX_DAILY_TRADES=100

# 最大持仓股票数
MAX_STOCK_COUNT=20

# 单只股票最大仓位（%）
MAX_POSITION_RATIO=20

# 止损比例（%）
STOP_LOSS_RATIO=5

# ============ 实盘策略配置 ============

# 策略运行频率 (minute, tick)
LIVE_FREQUENCY=minute

# 策略文件路径
LIVE_STRATEGY_FILE=./strategies/my_live_strategy.py

# 初始资金（仅首次运行）
LIVE_INITIAL_CASH=1000000

# 基准
LIVE_BENCHMARK=000300.XSHG

# ============ 系统配置 ============

# 日志配置（可用 `bullet-trade live ... --log-dir` 临时覆盖）
LOG_DIR=./logs/live
LOG_LEVEL=INFO
# 订阅/日志更详细信息（可选：DEBUG/INFO/WARNING/ERROR）

# 实盘运行目录（可用 `bullet-trade live ... --runtime-dir` 临时覆盖）
RUNTIME_DIR=./runtime

# QMT 实盘下单控制
# 单笔委托最大数量（超过自动拆单）
ORDER_MAX_VOLUME=1000000
# 同步下单最大等待秒数（0 表示异步立即返回）
TRADE_MAX_WAIT_TIME=16

# 市价保护价系数（默认 1.5%/-1.5%，策略显式指定时优先）
MARKET_BUY_PRICE_PERCENT=0.015
MARKET_SELL_PRICE_PERCENT=-0.015

# 策略事件超时（秒），超时的 on_bar 等事件将被丢弃
EVENT_TIME_OUT=60

# 交易时段覆写（用于期货/夜盘调试），逗号分隔多个时段
# 例如：09:30-11:30,13:00-15:00
SCHEDULER_MARKET_PERIODS=

# 实盘日志保留天数
LOG_RETENTION_DAYS=30

# 调试模式
DEBUG=false

# ============ 缓存配置 ============

# 实盘缓存有效期（分钟，建议短一些）
CACHE_TTL_MINUTES=5

# 启用缓存
ENABLE_CACHE=true

# ============ 性能优化 ============

# 使用 uvloop（提升实盘响应速度）
USE_UVLOOP=true

# 异步执行（建议开启）
ASYNC_EXECUTION=true
# 实时读取 portfolio 时的最小刷新间隔（毫秒），避免高频读取压垮券商接口
PORTFOLIO_REFRESH_THROTTLE_MS=200

# ============ 通知配置（可选） ============

# 邮件通知
EMAIL_ENABLED=false
# EMAIL_HOST=smtp.gmail.com
# EMAIL_PORT=587
# EMAIL_USER=your_email@gmail.com
# EMAIL_PASSWORD=your_password
# EMAIL_TO=recipient@example.com

# 企业微信机器人通知
# 配置 MESSAGE_KEY 后，send_msg 会自动调用企业微信机器人
MESSAGE_KEY=

# 钉钉机器人通知
# DINGTALK_WEBHOOK=https://oapi.dingtalk.com/robot/send?access_token=xxx

# ============ LiveEngine 后台配置 ============

# 账户同步
ACCOUNT_SYNC_ENABLED=true
ACCOUNT_SYNC_INTERVAL=5

# 订单同步
ORDER_SYNC_ENABLED=true
ORDER_SYNC_INTERVAL=3

# g 自动保存
G_AUTOSAVE_ENABLED=true
G_AUTOSAVE_INTERVAL=60

# Tick 订阅限制与轮询
TICK_SUBSCRIPTION_LIMIT=100
TICK_SYNC_ENABLED=true
TICK_SYNC_INTERVAL=2

# 风控后台任务
RISK_CHECK_ENABLED=false
RISK_CHECK_INTERVAL=300

# 券商心跳
BROKER_HEARTBEAT_INTERVAL=30

# 交易日守卫
CALENDAR_SKIP_WEEKEND=true
CALENDAR_RETRY_MINUTES=20

# 连接超时（秒）
CONNECTION_TIMEOUT=30

# 重试次数
MAX_RETRY_COUNT=3

# ============ 实盘建议配置 ============
#
# 🔴 生产环境（真实交易）：
#   LIVE_MODE=live
#   DEBUG=false
#   LOG_LEVEL=WARNING
#   CACHE_TTL_MINUTES=1
#   EMAIL_ENABLED=true  # 开启通知
#   MAX_ORDER_VALUE=50000  # 保守一些
#   MAX_DAILY_TRADES=50    # 保守的交易次数限制
#
# 🟡 测试环境（模拟盘）：
#   LIVE_MODE=dry_run
#   DEBUG=true
#   LOG_LEVEL=DEBUG
#   CACHE_TTL_MINUTES=5
#   EMAIL_ENABLED=false
#   MAX_DAILY_TRADES=100   # 测试环境可以放宽
#
# 🟢 开发环境：
#   DEFAULT_BROKER=simulator
#   DEBUG=true
#   LOG_LEVEL=DEBUG
#
# ⚠️ 安全提示：
#   1. 首次使用务必用 dry_run 模式测试
#   2. 不要提交 .env 文件到 git
#   3. 定期更改密码和 token
#   4. 使用专用账户进行量化交易
#   5. 设置合理的风控参数，特别是每日交易次数限制

# 远程 QMT server 服务端
QMT_SERVER_HOST=127.0.0.1
QMT_SERVER_PORT=58620
QMT_SERVER_TOKEN=please_change_me
#QMT_SERVER_ACCOUNT_KEY=default
#QMT_SERVER_SUB_ACCOUNT=
#QMT_SERVER_TLS_CERT=
#QMT_SERVER_LISTEN=0.0.0.0
#QMT_SERVER_MAX_CONNECTIONS=64
#QMT_SERVER_MAX_SUBSCRIPTIONS=200
